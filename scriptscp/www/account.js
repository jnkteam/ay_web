var AccountCommenJS = { bind: function() { $(".zfb_left .ainfo").hover(function() { $(this).addClass("hoverinfo") }, function() { $(this).removeClass("hoverinfo") }); $(".auth_box h2 a").click(function() { $(this).parents(".auth_box").remove() }); var a = $(".zfb_left").height(), b = $(".zfb_right").height(); if (a > b) { $(".zfb_right").height(a) } else { $(".zfb_left").height(b) } } }; AccountCommenJS.bind(); var UserRegisterJS = { provinceCode: "", cityCode: "", init: function(a) { $(".rcont a[class=yellowbtn]").bind("click", UserRegisterJS.doUserRegister); $("#divValidCode a,#divValidCode img").bind("click", UserRegisterJS.changeVC); if (a && a.provinceCode && a.cityCode) { UserRegisterJS.provinceCode = a.provinceCode; UserRegisterJS.cityCode = a.cityCode } $(".treaty a").click(function() { var b = $(".treaty .txt"); b.is(":hidden") ? b.show() : b.hide() }) }, changeVC: function() { $("#divValidCode img").attr("src", "/verifycode.htm?t=" + new Date().getTime()); $("#txtValidCode").val(""); return false }, doUserRegister: function() { if (!Validator.validateForm()) { return } var b = $("#txtPassword").val(); var a = new RSAKey(); a.setPublic(RSAPublicKey, "10001"); b = a.encrypt(b); $.post("/douserregister.htm", { loginCode: $("#txtLoginCode").val(), password: b, provinceCode: UserRegisterJS.provinceCode, cityCode: UserRegisterJS.cityCode, verifyCode: $("#txtValidCode").val() }, function(c) { if (c.resultCode == 1) { return $.doUrlRedirt("/registersuccess.htm?title=0&source=1") } else { UserRegisterJS.changeVC(); $.showMsgBox(c.resultMsg) } }) } }; var InviteUserRegisterJS = { provinceCode: "", cityCode: "", isSubmitData: false, init: function(a) { $(".regbg .register_btn").bind("click", InviteUserRegisterJS.doInviteUserRegister); $("#divValidCode a, #divValidCode img").bind("click", InviteUserRegisterJS.changeVC); if (a && a.provinceCode && a.cityCode) { InviteUserRegisterJS.provinceCode = a.provinceCode; InviteUserRegisterJS.cityCode = a.cityCode } }, changeVC: function() { $("#divValidCode img").attr("src", "/verifycode.htm?t=" + new Date().getTime()); $("#txtValidCode").val(""); return false }, doInviteUserRegister: function() { if (InviteUserRegisterJS.isSubmitData || !Validator.validateForm()) { return } var b = $("#txtPassword").val(); var a = new RSAKey(); a.setPublic(RSAPublicKey, "10001"); b = a.encrypt(b); InviteUserRegisterJS.isSubmitData = true; $(".regbg .register_btn span").text("注册中..."); $.post("/doinviteuserregister.htm", { loginCode: $("#txtLoginCode").val().trim(), password: b, provinceCode: InviteUserRegisterJS.provinceCode, cityCode: InviteUserRegisterJS.cityCode, verifyCode: $("#txtValidCode").val() }, function(c) { if (c.resultCode == 1) { return $.doUrlRedirt("/registersuccess.htm") } else { $(".regbg .register_btn span").text("免费注册"); InviteUserRegisterJS.isSubmitData = false; InviteUserRegisterJS.changeVC(); $.showMsgBox(c.resultMsg) } }) } }; var Bind51AccountJS = { check51AccountMsg: "", smsVCSender: null, init: function() { $(function() { $("#txtMobile").blur(function() { Bind51AccountJS.check51Account(false) }) }); Bind51AccountJS.smsVCSender = new $.SmsVCSender($("#txtMobile"), $("#txtValidCode_0"), $("#divSendSmsVC_0 a,#btnSendSms_0"), $("#btnSendVoice_0"), { uniqueMobile: false, overEvent: function() { $("#divSendSmsVC_0").remove(); $("#divSendSms_0").show() } }); $("#divSendSmsVC_0 a,#btnSendSms_0").bind("click", Bind51AccountJS.checkSendSms); $("#btnSendVoice_0").bind("click", Bind51AccountJS.checkSendVoice); $(".reg_btn a").bind("click", Bind51AccountJS.doBind51Account); $(".treaty a").click(function() { var a = $(".treaty .txt"); a.is(":hidden") ? a.show() : a.hide() }) }, checkSendSms: function() { if (Bind51AccountJS.check51Account(true)) { Bind51AccountJS.smsVCSender.sendSms() } }, checkSendVoice: function() { if (Bind51AccountJS.check51Account(true)) { Bind51AccountJS.smsVCSender.sendVoice() } }, check51Account: function(d) { var a = $("#txtMobile"), c = $("#txtMobile").val(); Validator.clearState(a, false); if (!Validator.Mobile.test(c)) { Validator.showFaildMsg(a, false); return false } if (d) { var f = $("#txtValidCode_0"), b = f.val(); if (!Validator.ValidCode.test(b)) { Validator.showFaildMsg(f, false); return false } } Bind51AccountJS.check51AccountMsg = ""; var e = $.postJsonSync("/check51account.htm", { mobile: c }); if (e.resultCode == 1) { return true } Bind51AccountJS.check51AccountMsg = e.resultMsg; $.showMsgBox(e.resultMsg); return false }, doBind51Account: function() { var b = $("#txtMobile").val(); if (Validator.Mobile.test(b) && !String.isNullOrWhiteSpace(Bind51AccountJS.check51AccountMsg)) { $.showMsgBox(Bind51AccountJS.check51AccountMsg); return false } if (!Validator.validateForm()) { return } var c = $("#txtPassword").val(); var a = new RSAKey(); a.setPublic(RSAPublicKey, "10001"); c = a.encrypt(c); $.post("/dobind51account.htm", { mobile: $("#txtMobile").val(), password: c, verifyCode: $("#txtMobileValidCode").val() }, function(d) { if (d.resultCode == 1) { return $.doUrlRedirt("/login.htm") } return $.showMsgBox(d.resultMsg) }) } }; var SetAlipayAccountJS = { checkAlipayAccountMsg: "", smsVCSender: null, init: function() { $(function() { $("#txtMobile").blur(function() { SetAlipayAccountJS.checkAlipayAccount(false) }) }); SetAlipayAccountJS.smsVCSender = new $.SmsVCSender($("#txtMobile"), $("#txtValidCode_0"), $("#divSendSmsVC_0 a,#btnSendSms_0"), $("#btnSendVoice_0"), { uniqueMobile: false, overEvent: function() { $("#divSendSmsVC_0").remove(); $("#divSendSms_0").show() } }); $("#divSendSmsVC_0 a,#btnSendSms_0").bind("click", SetAlipayAccountJS.checkSendSms); $("#btnSendVoice_0").bind("click", SetAlipayAccountJS.checkSendVoice); $(".reg_btn a").bind("click", SetAlipayAccountJS.doSetAlipayAccount); $(".treaty a").click(function() { var a = $(".treaty .txt"); a.is(":hidden") ? a.show() : a.hide() }) }, checkSendSms: function() { if (SetAlipayAccountJS.checkAlipayAccount(true)) { SetAlipayAccountJS.smsVCSender.sendSms() } }, checkSendVoice: function() { if (SetAlipayAccountJS.checkAlipayAccount(true)) { SetAlipayAccountJS.smsVCSender.sendVoice() } }, checkAlipayAccount: function(d) { var a = $("#txtMobile"), c = $("#txtMobile").val(); Validator.clearState(a, false); if (!Validator.Mobile.test(c)) { Validator.showFaildMsg(a, false); return false } if (d) { var f = $("#txtValidCode_0"), b = f.val(); if (!Validator.ValidCode.test(b)) { Validator.showFaildMsg(f, false); return false } } SetAlipayAccountJS.checkAlipayAccountMsg = ""; var e = $.postJsonSync("/checkalipayaccount.htm", { mobile: c }); if (e.resultCode == 1) { return true } SetAlipayAccountJS.checkAlipayAccountMsg = e.resultMsg; $.showMsgBox(e.resultMsg); return false }, doSetAlipayAccount: function() { var b = $("#txtMobile").val(); if (Validator.Mobile.test(b) && !String.isNullOrWhiteSpace(SetAlipayAccountJS.checkAlipayAccountMsg)) { $.showMsgBox(SetAlipayAccountJS.checkAlipayAccountMsg); return false } if (!Validator.validateForm()) { return } var c = $("#txtPassword").val(); var a = new RSAKey(); a.setPublic(RSAPublicKey, "10001"); c = a.encrypt(c); $.post("/dosetalipayaccount.htm", { mobile: $("#txtMobile").val(), password: c, verifyCode: $("#txtMobileValidCode").val() }, function(d) { if (d.resultCode == 1) { return $.doUrlRedirt("/login.htm") } return $.showMsgBox(d.resultMsg) }) } }; var RegisterSuccessJS = { init: function() { setInterval(function() { location.href = "/account/" }, 8000); googleConversion({ label: "GsmHCLmiwAMQz6Cr3AM" }); sosoConversion() } }; var CreateAccountByMobileJS = { init: function() { $(".reg_btn a").click(CreateAccountByMobileJS.doRegister) }, doRegister: function() { if (!Validator.validateForm()) { return } var b = $("#txtPassword").val(); var a = new RSAKey(); a.setPublic(RSAPublicKey, "10001"); b = a.encrypt(b); $.post("/docreateaccountbymobile.htm", { password: b }, function(c) { if (c.resultCode == 1) { $.showMsgBox(OriginalStringJS.createAccountSuccess.format($.HTMLEncode($("#spanUserMobile").text()), $.HTMLEncode($("#txtPassword").val())), function() { return $.doUrlRedirt("/account/") }) } else { $.showMsgBox(c.resultMsg) } }) } }; var VIPBoxJS = { init: function() { $(".zfb_vipbox .vipbox_middle .vipbox_title a").click(function() { $(".zfb_vipbox").remove(); $("#id_div_zz").remove() }); $("#id_div_zz").css("height", $(window).height() + "px"); $(".zfb_vipbox .upgrade-btn").click(function() { return $.doUrlRedirt("/account/vip/upgrade.htm") }) } }; var UserLevelTipBox = { init: function() { var a = document.body.clientHeight; var b = ($(window).height() - $(".score_box").height()) / 2 + $(window).scrollTop(); $(".div_zz").css("height", a + "px"); $(".score_box").css("top", b + "px"); $("a[name=closeLevelTipBox]").click(function() { return $.reloadUrl() }) } }; var IndexJS = { init: function() { $(".record_list .record_title ul li").bind("click", IndexJS.changeTab); VIPBoxJS.init(); UserLevelTipBox.init(); RentHelperJS.bindPayRentListEvent(); AccountCommenJS.bind(); $("#aPayeeAccount").click(PayeeJS.Index.showPayeeAccount) }, changeTab: function() { var d = $(".record_list .record_title ul li"); var e = $(".pay_list"); var b = $(".rent_record"); var c = $(".money_record"); d.removeClass("on"); $(this).addClass("on"); var a = d.index($(this)); if (a == 0) { b.hide(); c.hide(); e.show() } else { if (a == 1) { e.hide(); c.hide(); if (b.length == 0) { b = $(OriginalStringJS.chargeRentListLoading); b.appendTo($(".record_list")); IndexJS.loadChargeRentList() } b.show() } else { if (a == 2) { e.hide(); b.hide(); if (c.length == 0) { c = $(OriginalStringJS.earnestListLoading); c.appendTo($(".record_list")); IndexJS.loadEarnestList() } c.show() } } } }, loadChargeRentList: function() { $.post("/chargerent/getchargerentpagelist.htm", { pageSize: 3, pageIndex: 1 }, function(b) { if (b.resultCode == 1) { var a = RentHelperJS.getChargeRentListHtml(b.data.dataList); if (a == "") { $(".rent_record .norecord").text("暂无记录 ^_^") } else { var c = '<div class="rent_list clearfix"><ul>' + a + "</ul></div>"; $(".rent_record .norecord").remove(); $(".rent_record").append($(c)) } } else { $.showMsgBox(b.resultMsg); $(".rent_record .norecord").html('收房租记录加载出错，<a href="javascript:void(0)">点击重试</a>'); $(".rent_record .norecord a").bind("click", IndexJS.loadChargeRentList) } }) }, loadEarnestList: function() { $.post("/account/getearnestpagelist.htm", { pageSize: 3, pageIndex: 1 }, function(b) { if (b.resultCode == 1) { var a = RentHelperJS.getEarnestListHtml(b.data.dataList); if (a == "") { $(".money_record .norecord").text("暂无记录 ^_^") } else { var c = '<div class="rent_list clearfix"><ul>' + a + "</ul></div>"; $(".money_record .norecord").remove(); $(".money_record").append($(c)) } } else { $.showMsgBox(b.resultMsg); $(".money_record .norecord").html('保证金记录加载出错，<a href="javascript:void(0)">点击重试</a>'); $(".money_record .norecord a").bind("click", IndexJS.loadEarnestList) } }) } }; var RentRecordJS = { init: function() { $(".ransaction .redetail input[type=text]").bind("click", WdatePicker); var a = $(".ransaction .redetail p a"); var c = new Date(); var b = c.format("yyyy-MM-dd"); if ($.getQueryString("startDate") == b && $.getQueryString("startDate") == $.getQueryString("endDate")) { $(a[0]).parent().addClass("on") } $(a[0]).click(function() { var e = new Date(); var d = e.format("yyyy-MM-dd"); return $.editUrlParam({ startDate: d, endDate: d }) }); if ($.getQueryString("startDate") == c.addDays(-7).format("yyyy-MM-dd") && $.getQueryString("endDate") == b) { $(a[1]).parent().addClass("on") } $(a[1]).click(function() { var d = new Date(); return $.editUrlParam({ startDate: d.addDays(-7).format("yyyy-MM-dd"), endDate: d.format("yyyy-MM-dd") }) }); if ($.getQueryString("startDate") == c.addMonths(-1).format("yyyy-MM-dd") && $.getQueryString("endDate") == b) { $(a[2]).parent().addClass("on") } $(a[2]).click(function() { var d = new Date(); return $.editUrlParam({ startDate: d.addMonths(-1).format("yyyy-MM-dd"), endDate: d.format("yyyy-MM-dd") }) }); if ($.getQueryString("startDate") == c.addMonths(-3).format("yyyy-MM-dd") && $.getQueryString("endDate") == b) { $(a[3]).parent().addClass("on") } $(a[3]).click(function() { var d = new Date(); return $.editUrlParam({ startDate: d.addMonths(-3).format("yyyy-MM-dd"), endDate: d.format("yyyy-MM-dd") }) }); $(".ransaction .redetail input[type=button]").bind("click", RentRecordJS.doSearch) }, doSearch: function() { var a = $(".ransaction .redetail input[type=text]"); return $.setUrlParam({ tab: $.getQueryString("tab"), startDate: $(a[0]).val(), endDate: $(a[1]).val() }) } }; var PayRentListJS = { init: function() { RentRecordJS.init(); RentHelperJS.bindPayRentListEvent() } }; var ChargeRentListJS = { init: function() { RentRecordJS.init() } }; var EarnestListJS = { init: function() { RentRecordJS.init() } }; var MessageJS = { init: function() { $(".message_list h3 a").click(MessageJS.makeAllRead); $(".message_list ul li input[type=checkbox]").change(function() { if ($(this).attr("checked") == "checked") { $(this).parents("li").addClass("on1") } else { $(this).parents("li").removeClass("on1") } }); $(".message_list ul li").each(function() { var c = $(this).find("span"); for (var b = 2; b < c.length - 1; b++) { $(c[b]).click(MessageJS.readMessage) } }); var a = $(".message_list .message_tt a"); $(a[0]).click(MessageJS.selectAll); $(a[1]).click(MessageJS.reverseSelect); $(a[2]).click(MessageJS.removeSelectedMessage) }, makeAllRead: function() { $.post("/account/message/markallmessagereaded.htm", {}, function(a) { if (a.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(a.resultMsg) } }) }, readMessage: function() { var e = $(this).parents("li"); var d = e.attr("msgId"); var f = e.find(".email_icon1").length > 0; if (f) { var a = $.postJsonSync("/account/message/readmessage.htm", { msgId: d }); if (a.resultCode == 1) { e.find(".email_icon1").removeClass("email_icon1").addClass("email_icon"); e.find(".fbold").removeClass("fbold") } else { $.showMsgBox(a.resultMsg); return } } var c = e.find("span"); var b = OriginalStringJS.readMessageHtml.format($(c[2]).text(), $(c[4]).text(), $(c[3]).attr("msgcontent")); $(b).dialog({ title: "站内消息", width: 650, modal: true }); $(".bcont .newsbox_bottom p a").click(function() { MessageJS.removeMessage(d) }) }, selectAll: function() { $(".message_list ul li input[type=checkbox]").each(function() { $(this).attr("checked", "checked"); $(this).change() }) }, reverseSelect: function() { $(".message_list ul li input[type=checkbox]").each(function() { $(this).attr("checked", $(this).attr("checked") != "checked"); $(this).change() }) }, removeSelectedMessage: function() { var a = new Array(); $(".message_list ul li input[type=checkbox]").each(function() { if ($(this).attr("checked") == "checked") { a.push($(this).parents("li").attr("msgId")) } }); if (a.length == 0) { $.showMsgBox("请先选择要删除的站内消息！"); return } $.showConfirmBox("您确定要删除当前选中的站内消息吗？", function() { MessageJS.doRemoveMessage(a) }) }, removeMessage: function(b) { var a = new Array(); a.push(b); MessageJS.doRemoveMessage(a) }, doRemoveMessage: function(a) { a = a.join(","); $.post("/account/message/removemessage.htm", { msgIds: a }, function(b) { if (b.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(b.resultMsg) } }) } }; var SafeJS = { ModifyPwd: { init: function() { $(".safe_password .pwd .rent_btn a").click(SafeJS.ModifyPwd.doModifyPwd) }, doModifyPwd: function() { if (!Validator.validateForm()) { return } var a = $("#txtOriginalPwd").val(); var b = $("#txtNewPwd").val(); var c = new RSAKey(); c.setPublic(RSAPublicKey, "10001"); a = c.encrypt(a); b = c.encrypt(b); $.post("/account/safe/domodifypwd.htm", { originalPwd: a, newPwd: b }, function(d) { if (d.resultCode == 1) { $.showMsgBox("修改成功！", function() { return $.doUrlRedirt("/Member/Userinfo.aspx") }) } else { $.showMsgBox(d.resultMsg) } }) } }, BindMobile: { init: function() { var b = true; if ($("#txtMobile").attr("serverValid")) { b = false } var a = new $.SmsVCSender($("#txtMobile"), $("#txtValidCode_0"), $("#divSendSmsVC_0 a,#btnSendSms_0"), $("#btnSendVoice_0"), { overEvent: function() { $("#divSendSmsVC_0").remove(); $("#divSendSms_0").show() }, selfMobile: b, uniqueMobile: !b }); $("#divSendSmsVC_0 a,#btnSendSms_0").bind("click", function() { a.sendSms() }); $("#btnSendVoice_0").bind("click", function() { a.sendVoice() }); $(".rent_btn a").click(SafeJS.BindMobile.doBindMobile) }, doBindMobile: function() { if (!Validator.validateForm()) { return } $.post("/account/safe/dobindmobile.htm", { mobile: $("#txtMobile").val(), vc: $("#txtMobileValidCode").val(), mid: $.getQueryString("mid"), cid: $.getQueryString("cid"), omobile: $.getQueryString("om") }, function(f) { if (f.resultCode == 1) { var d = f.data; var e = "", a = "", c = ""; e = encodeURIComponent(d.md5Sum); var b = "bindmobile.htm?mid=" + e; if (d.successId) { a = encodeURIComponent(d.successId); b += "&sid=" + a } if (d.confirmId) { c = encodeURIComponent(d.confirmId); b += "&cid=" + c } if (d.isFirstBind) { b += "&f=1" } b += "&om=" + encodeURIComponent($("#txtMobile").val()); return $.doUrlRedirt(b) } else { $.showMsgBox(f.resultMsg) } }) } }, RealName: { init: function(a) { var b = { successHandler: function(j, e) { if (j.indexOf("_new") > -1) { j = j.replace("_new", "") } var f = e.data.staticDomain + e.data.filePath + "x_" + e.data.fileName; if ($(".examplebox").length == 0) { var h = OriginalStringJS.safeRealNameUploadPanel.format(f, j == "idcard1" ? "2" : "3", j == "idcard1" ? OriginalStringJS.safeRealNameUploadTip1 : OriginalStringJS.safeRealNameUploadTip2, j); $(h).dialog({ title: "确认上传的身份证", width: 805, modal: true, buttons: [{ text: "确定", "class": "comm_dialog_btn_save", click: function() { $(this).dialog("destroy") } }] }); b.category = j == "idcard1" ? a.imgCategory1 : a.imgCategory2; new ImageUpload("{0}_new".format(j), b) } else { SafeJS.RealName.doRemoveIdCardImg(SafeJS.RealName.currentImgId); $("#imgCurrentUpload").attr("src", f) } SafeJS.RealName.currentImgId = e.data.fileId; var i = e.data.staticDomain + e.data.filePath + "n_" + e.data.fileName; var c = e.data.fileId; var g = '<li><p class="pic"><img src="{0}" title="查看大图" /></p><p><a href="javascript:void(0)" fid="{1}">删除</a></p></li>'.format(i, c); var d = $(g); $("#div_{0} ul".format(j)).append(d); d.find("a").click(SafeJS.RealName.removeIdCardImg); SafeJS.RealName.bindShowPhoto(d) } }; if (a) { b.owner = a.userId; b.category = a.imgCategory1; new ImageUpload("idcard1", b); b.category = a.imgCategory2; new ImageUpload("idcard2", b) } $(".examplephoto img").click(function() { var c = $(this).attr("src"); c = c.replace("ephoto.jpg", "ephoto2.jpg").replace("ephoto1.jpg", "ephoto3.jpg"); var d = "<div class='comm_dialog_cont'><div class='dialog_photo'><img src='" + c + "'/></div></div>"; $(d).dialog({ title: "查看大图", modal: true, width: 680, buttons: [{ text: "确定", "class": "comm_dialog_btn_save", click: function() { $(this).dialog("destroy") } }] }) }); $(".updown_photo ul li a").click(SafeJS.RealName.removeIdCardImg); $(".rent_btn .rbtn_middle").click(SafeJS.RealName.doRealNameAudit); SafeJS.RealName.bindShowPhoto($(".updown_photo")) }, bindShowPhoto: function(a) { a.find("img").click(function() { $.showDialogPhoto($(this).attr("src"), "认证资料照片") }) }, removeIdCardImg: function() { var a = $(this).attr("fid"); $.showConfirmBox("您确定要删除当前照片吗？", function() { SafeJS.RealName.doRemoveIdCardImg(a) }) }, doRemoveIdCardImg: function(a) { $.post("/account/safe/removeusercredentialnoimg.htm", { fid: a }, function(b) { if (b.resultCode == 1) { $("a[fid=" + a + "]").parents("li").remove() } else { $.showMsgBox(b.resultMsg) } }) }, doRealNameAudit: function() { if (!Validator.validateForm()) { return } if ($("#div_idcard1 ul li").length == 0) { $.showMsgBox("请上传身份证正面照片后再提交认证！"); return } else { if ($("#div_idcard2 ul li").length == 0) { $.showMsgBox("请上传身份证反面照片后再提交认证！"); return } } $.post("/account/safe/dorealnameaduit.htm", { name: $("#txtName").val(), idCard: $("#txtIdCard").val() }, function(a) { if (a.resultCode == 1) { return $.doUrlRedirt("/Member/Userinfo.aspx") } else { $.showMsgBox(a.resultMsg) } }) } }, AccountState: { init: function(a) { var b = { successHandler: function(j, e) { var f = e.data.staticDomain + e.data.filePath + "x_" + e.data.fileName; if ($(".examplebox").length == 0) { var h = OriginalStringJS.safeAccountAuditUploadPanel.format(f, j == "idCard1" ? "2" : "3", j == "idcard1" ? OriginalStringJS.safeAccountAuditUploadTip1 : OriginalStringJS.safeAccountAuditUploadTip2, j + "_tmp"); $(h).dialog({ title: "确认上传的照片", width: 805, modal: true, buttons: [{ text: "确定", "class": "comm_dialog_btn_save", click: function() { $(this).dialog("destroy") } }] }); SafeJS.AccountState.idCardUploadParams.category = j == "idCard1" ? a.imgCategory1 : a.imgCategory2; new ImageUpload(j + "_tmp", SafeJS.AccountState.idCardUploadParams) } else { SafeJS.AccountState.doRemoveRealNameImg(SafeJS.AccountState.currentImgId); $("#imgCurrentUpload").attr("src", f) } SafeJS.AccountState.currentImgId = e.data.fileId; var i = e.data.staticDomain + e.data.filePath + "n_" + e.data.fileName; var c = e.data.fileId; var g = '<li><div class="pic"><img src="{0}" title="点击查看大图"/></div><p><a href="###" imgId="{1}">删除</a></p></li>'.format(i, c); var d = $(g); $(j.startsWith("idCard1") ? "#ulAccountState1" : "#ulAccountState2").append(d); d.find("a").click(SafeJS.AccountState.showRemoveRealNameImg); SafeJS.AccountState.bindShowPhoto(d) } }; if (a) { SafeJS.AccountState.userId = a.userId; SafeJS.AccountState.category1 = a.imgCategory1; SafeJS.AccountState.category2 = a.imgCategory2; b.owner = a.userId; b.category = a.imgCategory1; new ImageUpload("idCard1", b); b.category = a.imgCategory2; new ImageUpload("idCard2", b); SafeJS.AccountState.idCardUploadParams = b } if ($.isSupportFlash()) { $("#divOnline1,#divOnline2").click(SafeJS.AccountState.showSwfPhoto).show() } $(".upphotos ul li a").click(SafeJS.AccountState.showRemoveRealNameImg); $(".rent_btn .rbtn_middle").click(SafeJS.AccountState.doAccountState); SafeJS.AccountState.bindShowPhoto($(".upphotos")) }, showSwfPhoto: function() { var strId = $(this).attr("id"); var strHtml = String.format('<div class="video-box"><div class="remind"><div class="ricon">{0}</div></div><div class="video-cont"><div class="vleft"><h2>' + (strId == "divOnline1" ? "上传手持身份证头部照" : "上传上半身照") + '：</h2><div class="video" id="divSwfPhoto"></div><div style="display:none;"><a href="###" class="vbtn"></a></div><div class="clearfix v-btn" style="display:none;"><a href="###" class="cpbtn fl">重拍</a><a href="###" class="bcbtn fl">保存</a></div></div><div class="vright"><h2>示例：</h2><div class="video"><img src="' + Config.ImageHomeSite + '/merchant/realname/ephoto{1}.jpg" width="460" height="340" /></div></div></div></div>', strId == "divOnline1" ? "右侧是手持身份证头部照示例，照片中需要正面照片，能看清姓名、身份证号码等信息。" : "右侧是上半身照示例，照片中需要正面照片，能看清脸部等信息。", strId == "divOnline1" ? 2 : 3); var objDialog = $(strHtml); objDialog.dialog({ title: "在线拍照", width: 975, modal: true }); var strUploadUrl = "{0}//{1}{2}/uploader/uploadimg.htm?category={3}&owner={4}".format(window.location.protocol, window.location.hostname, window.location.port.length == 0 ? "" : (":" + window.location.port), strId == "divOnline1" ? SafeJS.AccountState.category1 : SafeJS.AccountState.category2, SafeJS.AccountState.userId); var settings = { flash_url: Config.ScriptHomeSite + "/swfphoto/swfphoto.swf", uploadUrl: strUploadUrl, fileFieldName: "file", placeholder_id: "divSwfPhoto", width: 460, height: 340, initCompleted_handler: function(hasCamera) { if (hasCamera) { objDialog.find(".vbtn").parent().show() } }, snapped_handler: function() { objDialog.find(".vbtn").parent().hide(); objDialog.find(".cpbtn").parent().show() }, resetted_handler: function() { objDialog.find(".vbtn").parent().show(); objDialog.find(".cpbtn").parent().hide() }, uploadBegin_handler: function() { }, uploadProgress_handler: function(bytesLoaded, bytesTotal) { }, uploadError_handler: function(errorCode, message) { $.showMsgBox("上传错误" + errorCode + ":" + message + "...") }, uploadSuccess_handler: function(serverData) { eval("var jsonData=" + serverData); if (jsonData.resultCode == 1) { var strImage = jsonData.data.staticDomain + jsonData.data.filePath + "n_" + jsonData.data.fileName; var lImgId = jsonData.data.fileId; var strLiHtml = '<li><div class="pic"><img src="{0}" title="点击查看大图"/></div><p><a href="###" imgId="{1}">删除</a></p></li>'.format(strImage, lImgId); var objLi = $(strLiHtml); $(strId == "divOnline1" ? "#ulAccountState1" : "#ulAccountState2").append(objLi); objLi.find("a").click(SafeJS.AccountState.showRemoveRealNameImg); SafeJS.AccountState.bindShowPhoto(objLi); objDialog.dialog("destroy") } else { $.showMsgBox(jsonData.resultMsg) } } }; var swfPhoto = new SWFPhoto(settings); objDialog.find(".vbtn").click(function() { swfPhoto.doSnap() }); objDialog.find(".cpbtn").click(function() { swfPhoto.resetCamera() }); objDialog.find(".bcbtn").click(function() { swfPhoto.doUpload() }) }, bindShowPhoto: function(a) { a.find("img").click(function() { $.showDialogPhoto($(this).attr("src"), "所有人认证照片") }) }, showRemoveRealNameImg: function() { var a = $(this).attr("imgId"); $.showConfirmBox("您确定要删除当前图片吗？", function() { SafeJS.AccountState.doRemoveRealNameImg(a) }) }, doRemoveRealNameImg: function(a) { $.post("/account/safe/removerealnameimg.htm", { imgId: a, type: 2 }, function(b) { if (b.resultCode == 1) { $("a[imgId=" + a + "]").parents("li").remove() } else { $.showMsgBox(b.resultMsg) } }) }, doAccountState: function() { if (!Validator.validateForm()) { return } if ($("#ulAccountState1 li").length == 0) { $.showMsgBox("请上传手持身份证头部照"); return } if ($("#ulAccountState2 li").length == 0) { $.showMsgBox("请上传上半身照"); return } $.post("/account/safe/doaccountstateaduit.htm", {}, function(a) { if (a.resultCode == 1) { $.showMsgBox("提交认证信息成功！", function() { return $.doUrlRedirt("/account/") }) } else { $.showMsgBox(a.resultMsg) } }) } }, BindEmail: { init: function() { $(".pwd_phone .rent_btn a").click(SafeJS.BindEmail.sendEmail); $(".problem dl dd a").click(SafeJS.BindEmail.reSendEmail) }, sendEmail: function() { if (!Validator.validateForm()) { return } var a = $(".pwd_phone input[type=text]").val(); if (String.isNullOrEmpty(a)) { a = $(".pwd_phone .element").text() } SafeJS.BindEmail.doSendEmail(a) }, reSendEmail: function() { SafeJS.BindEmail.doSendEmail($(".pwd_phone dl dd p .forange").text()) }, doSendEmail: function(a) { if (!Validator.Email.test(a)) { return } $.post("/account/safe/dosendbindemail.htm", { email: a }, function(e) { if (e.resultCode == 1) { var c = e.data; var d = ""; d = encodeURIComponent(c.md5Sum); var b = "bindemail.htm?mid=" + d; b += "&sid=" + encodeURIComponent(c.successId); b += "&ve=" + encodeURIComponent(c.email); return $.doUrlRedirt(b) } else { $.showMsgBox(e.resultMsg) } }) } }, SafeQA: { question1: "", question2: "", question3: "", allquestions: "", init: function() { if ($("select").length > 0) { $(".rent_btn a").click(SafeJS.SafeQA.confirmQA) } else { $(".rent_btn a").click(SafeJS.SafeQA.answerQA) } SafeJS.SafeQA.allquestions = $("#selQuestion1").html(); $("select[id*='selQuestion']").change(function() { SafeJS.SafeQA.changeQuestion(this) }) }, changeQuestion: function(d) { switch ($(d).attr("id")) { case "selQuestion1": SafeJS.SafeQA.question1 = $.trim($(d).val()) == "0" ? "" : $.trim($(d).val()); break; case "selQuestion2": SafeJS.SafeQA.question2 = $.trim($(d).val()) == "0" ? "" : $.trim($(d).val()); break; case "selQuestion3": SafeJS.SafeQA.question3 = $.trim($(d).val()) == "0" ? "" : $.trim($(d).val()); break } var c = SafeJS.SafeQA.question1.length > 0 ? SafeJS.SafeQA.question1 : "aaaaa"; var b = SafeJS.SafeQA.question2.length > 0 ? SafeJS.SafeQA.question2 : "aaaaa"; var a = SafeJS.SafeQA.question3.length > 0 ? SafeJS.SafeQA.question3 : "aaaaa"; $("#selQuestion1").html(SafeJS.SafeQA.allquestions).children(":contains('" + b + "'),:contains('" + a + "')").remove(); $("#selQuestion1").children(":contains('" + c + "')").attr("selected", "selected"); $("#selQuestion2").html(SafeJS.SafeQA.allquestions).children(":contains('" + c + "'),:contains('" + a + "')").remove(); $("#selQuestion2").children(":contains('" + b + "')").attr("selected", "selected"); $("#selQuestion3").html(SafeJS.SafeQA.allquestions).children(":contains('" + c + "'),:contains('" + b + "')").remove(); $("#selQuestion3").children(":contains('" + a + "')").attr("selected", "selected") }, answerQA: function() { if (!Validator.validateForm()) { return } var b = $("#txtAnswer1"); var a = $("#txtAnswer2"); $.post("/account/safe/answerqa.htm", { answerId1: b.attr("aid"), answer1: b.val(), answerId2: a.attr("aid"), answer2: a.val() }, function(c) { if (c.resultCode == 1) { return $.doUrlRedirt("safeqa.htm?mid=" + encodeURIComponent(c.data)) } else { $.showMsgBox(c.resultMsg) } }) }, confirmQA: function() { if (!Validator.validateForm()) { return } var b = OriginalStringJS.safeQAConfirmHtml.format($("#selQuestion1").val(), $("#txtAnswer1").val(), $("#selQuestion2").val(), $("#txtAnswer2").val(), $("#selQuestion3").val(), $("#txtAnswer3").val()); var a = $(".pwd_step").parent(); $(".pwd_step").remove(); a.append($(b)); $(".rent_btn a").click(SafeJS.SafeQA.doConfirmQA); var c = $(".safety_title ul li"); c.removeClass("on1"); $(c[c.length - 2]).addClass("on1") }, doConfirmQA: function() { var b = $(".step_cont .step_tt div .f6 span"); var a = $(".step_cont .step_tt div .forange"); $.post("/account/safe/savesafeqa.htm?mid=" + $.getQueryString("mid"), { question1: $(b[0]).text(), answer1: $(a[0]).text(), question2: $(b[1]).text(), answer2: $(a[1]).text(), question3: $(b[2]).text(), answer3: $(a[2]).text() }, function(d) { if (d.resultCode == 1) { var e = OriginalStringJS.safeQASuccessHtml; var c = $(".pwd_step2").parent(); $(".pwd_step2").remove(); c.append($(e)); var f = $(".safety_title ul li"); f.removeClass("on1"); $(f[f.length - 1]).addClass("on1") } else { $.showMsgBox(d.resultMsg) } }) } } }; var InfoJS = { init: function(b) { var a = $(".person_right>p>img"); var c = { successHandler: function(f, d) { var e = d.data.staticDomain + d.data.filePath + "n_" + d.data.fileName; $.post("/account/info/setuserphoto.htm", { photo: e }, function(g) { if (g.resultCode == 1) { a.attr("src", e); $(".person_right .removephoto").show(); $.showMsgBox("图片上传成功", function() { return $.reloadUrl() }) } else { $.showMsgBox(g.resultMsg) } }) } }; if (b) { c.category = b.imgCategory; c.owner = b.userId } new ImageUpload("user", c); $(".removephoto").click(InfoJS.removePhoto) }, removePhoto: function() { $("<div class='comm_dialog_cont'>您确定要删除当前头像吗？</div>").dialog({ title: "温馨提示", modal: true, buttons: [{ text: "确 定", "class": "comm_dialog_btn_save", click: function() { InfoJS.doRemovePhoto(); $(this).dialog("destroy") } }, { text: "取 消", "class": "comm_dialog_btn_cancel", click: function() { $(this).dialog("destroy") } }] }) }, doRemovePhoto: function() { $.post("/account/info/removeuserphoto.htm", {}, function(a) { if (a.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(a.resultMsg) } }) } }; var AccountVipJS = { Index: { init: function() { VIPBoxJS.init() } }, Upgrade: { init: function() { VipJS.init(); $(".upgrade-content .vipcode .vip-copy input").each(function() { var a = $(this); var b = new ZeroClipboard(a, { moviePath: Config.ScriptHomeSite + "/zeroclipboard/zeroclipboard.swf", trustedDomains: "*", allowScriptAccess: "always" }); b.on("noflash", function(c) { a.unbind("click").bind("click", function() { $.setClipboard(a.attr("data-clipboard-text")) }) }); b.on("complete", function(c, d) { $.showMsgBox("复制成功!") }) }); $(".upgrade-content .vipcode .vip-email a").click(AccountVipJS.Upgrade.sendVipCodeEmail) }, sendVipCodeEmail: function() { var a = $(this).parents("dl").find(".code p span").text(); $(OriginalStringJS.sendVipCodeEmail.format(a)).dialog({ title: "邮件发送VIP激活码", modal: true, width: 360 }); Validator.bind($(".vip_box")); $(".vip_box input[type=button]").click(AccountVipJS.Upgrade.doSendVipCodeEmail); $(".vip_box input[type=text]").blur() }, doSendVipCodeEmail: function() { if (!Validator.validateForm($(".vip_box"))) { return } $.post("/account/sendvipcodeemail.htm", { vipCode: $(".vip_box input[type=hidden]").val(), toEmail: $(".vip_box input[type=text]").val() }, function(a) { if (a.resultCode == 1) { $(".vip_box").dialog("destroy"); $.showMsgBox("发送成功！") } else { Validator.showMsg($(".vip_box input[type=text]"), a.resultMsg) } }) } } }; var VipJS = { init: function() { $(".vip-upgrade input[type=button]").bind("click", VipJS.upgradeVip) }, upgradeVip: function() { var b = $(".vip-upgrade input[type=text]").val(); var a = /[a-zA-Z0-9]{16}/gi.test(b); if (!a) { $.showMsgBox("请输入正确的激活码，激活码为16个字符！"); return } $.post("/account/doupgradevip.htm", { code: b }, function(c) { if (c.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(c.resultMsg) } }) } }; var GetPwdJS = { Index: { init: function() { $(".getpassword span a, .getpassword img").click(GetPwdJS.Index.changeVC); $(".rent_btn a").click(GetPwdJS.Index.checkLoginCode) }, changeVC: function() { $(".getpassword img").attr("src", "/verifycode.htm?t=" + new Date().getTime()); $("#txtVerifyCode").val(""); return false }, checkLoginCode: function() { if (!Validator.validateForm()) { return } var a = $("#txtLoginCode").val(); $.post("/getpwd/dogetpwd.htm", { loginCode: a, vcString: $("#txtVerifyCode").val() }, function(b) { if (b.resultCode == 1) { return $.doUrlRedirt("way.htm?loginCode=" + encodeURIComponent($("#txtLoginCode").val()) + "&sign=" + encodeURIComponent(b.data)) } else { $.showMsgBox(b.resultMsg); GetPwdJS.Index.changeVC() } }) } }, ByMobile: { init: function() { var a = new $.SmsVCSender($("#txtMobile"), $("#txtValidCode_0"), $("#divSendSmsVC_0 a,#btnSendSms_0"), $("#btnSendVoice_0"), { overEvent: function() { $("#divSendSmsVC_0").remove(); $("#divSendSms_0").show() }, uniqueMobile: false }); $("#divSendSmsVC_0 a,#btnSendSms_0").bind("click", function() { a.sendSms() }); $("#btnSendVoice_0").bind("click", function() { a.sendVoice() }); $(".rent_btn a").click(GetPwdJS.ByMobile.doByMobile) }, doByMobile: function() { if (!Validator.validateForm()) { return } $.post("/getpwd/dobymobile.htm", { loginCode: $.getQueryString("loginCode"), sign: $.getQueryString("sign"), vcString: $("#txtMobileValidCode").val() }, function(a) { if (a.resultCode == 1) { return $.doUrlRedirt("changepwd.htm?from=mobile&loginCode=" + encodeURIComponent($.getQueryString("loginCode")) + "&sign=" + encodeURIComponent(a.data)) } else { $.showMsgBox(a.resultMsg) } }) } }, ByEmail: { init: function(a) { $(".bgray_btn a").click(function() { GetPwdJS.ByEmail.doSendEmail(a) }) }, doSendEmail: function(a) { if (!Validator.Email.test(a)) { return } $.post("/getpwd/dobyemail.htm", { loginCode: $.getQueryString("loginCode"), sign: $.getQueryString("sign") }, function(b) { if (b.resultCode == 1) { $(".prompt").text("租房宝向您的邮箱发送了一封邮件，请查收"); $.showMsgBox("发送成功，请登录邮箱查看！") } else { $.showMsgBox(b.resultMsg) } }) } }, ByQA: { init: function() { $(".rent_btn a").click(GetPwdJS.ByQA.doByQA) }, doByQA: function() { if (!Validator.validateForm()) { return } var b = $("#txtAnswer1"); var a = $("#txtAnswer2"); $.post("/getpwd/dobyqa.htm", { loginCode: $.getQueryString("loginCode"), sign: $.getQueryString("sign"), answerId1: b.attr("aid"), answer1: b.val(), answerId2: a.attr("aid"), answer2: a.val() }, function(c) { if (c.resultCode == 1) { return $.doUrlRedirt("changepwd.htm?from=qa&loginCode=" + encodeURIComponent($.getQueryString("loginCode")) + "&sign=" + encodeURIComponent(c.data)) } else { $.showMsgBox(c.resultMsg) } }) } }, ChangePwd: { init: function() { $(".rent_btn a").click(GetPwdJS.ChangePwd.doChangePwd) }, doChangePwd: function() { if (!Validator.validateForm()) { return } var a = $("#txtNewPwd").val(); var c = $("#txtConfirmPwd").val(); if (a != c) { Validator.showMsg($("#txtConfirmPwd"), "确认密码不符"); return } var b = new RSAKey(); b.setPublic(RSAPublicKey, "10001"); a = b.encrypt(a); $.post("/getpwd/dochangepwd.htm", { from: $.getQueryString("from"), loginCode: $.getQueryString("loginCode"), sign: $.getQueryString("sign"), pwd: a }, function(d) { if (d.resultCode == 1) { return $.doUrlRedirt("success.htm") } else { $.showMsgBox(d.resultMsg) } }) } } }; var PayeeJS = { Index: { init: function() { $("#aPayeeAccount").click(PayeeJS.Index.showPayeeAccount); $(".admin_box .admin-cont .modify_payee").click(PayeeJS.Index.showPayeeAccount); $(".admin-cont").hover(function() { $(this).addClass("on") }, function() { $(this).removeClass("on") }); $(".admin-add").hover(function() { $(this).addClass("on1") }, function() { $(this).removeClass("on1") }); $(".admin-cont .close a").click(PayeeJS.Index.showDeletePayee) }, showPayeeAccount: function() { var g = $(this).parents(".admin-cont").attr("dataId"); if (g == undefined || g == null) { g = 0 } var e = $.postJsonSync("/account/payee/getjson4payeeaccountedit.htm", { autoId: g }); if (e.resultCode != 1) { $.showMsgBox(e.resultMsg); return } var k = e.data.userPayee; var r = e.data.payeeName; var f = e.data.payeePhone; var b = 1; var c = e.data.payeeCardNo; var l = e.data.isRealNamed; var d = e.data.isMobiled; var n = false; var q = k == null || k == undefined; var j = new Array(); j.push('<div class="item-list ui-prompt" style="margin-left:0px;">'); j.push('<div class="item clearfix"><label class="lab" id="spanPayeeName">开户姓名：</label><div class="element" style="width:140px"><input type="hidden" id="hidAutoId" value="{0}"/><input type="text" class="text" id="txtPayeeName" value="{1}" {2} require="true" dataType="UserName" style="width:130px;" msg="请填写正确的银行卡开户姓名" rig="请填写银行卡开户姓名"/></div></div>'.format(g, $.HTMLEncode(r), l ? ' disabled="disabled" ' : "")); j.push('<div class="item clearfix"><label class="lab">选择银行：</label><div class="fl"><select class="sel" id="selPayeeBank" require="true" dataType="Compare" operator="GreaterThan" to="0" rig="请选择银行" msg="请选择银行" ><option value="0">请选择</option>'); var o = q ? 0 : k.payeeBank; for (var p = 0; p < e.data.bankList.length; p++) { var h = e.data.bankList[p]; if (h.value == o && h.hasSubbranch) { n = true } j.push('<option value="{0}" hasSubbranch="{1}"{2}>{3}</option>'.format(h.value, h.hasSubbranch, h.value == o ? 'selected="selected"' : "", h.name)) } j.push("</select></div></div>"); if (b == 1) { j.push('<div class="item clearfix pbottom add"><label class="lab" style=" line-height:18px;" id="spanPayeeCardNo">银行卡号：<br/><span class="f12 fgray" id="spanPayeeCardNoTip1">不支持存折&nbsp;&nbsp;</span></label><div class="element" style="width:200px;"><input type="text" class="text" style="width:190px;" maxlength="24" id="txtPayeeCardNo" value="{0}" require="true" dataType="CreditCard" rig="请仔细填写并核对收款人银行卡卡号(不支持信用卡和存折)" msg="请输入正确的银行卡卡号" /></div></div><div class="item clearfix" style="padding:0px; line-height:20px;"><label class="lab">&nbsp;</label><span class="fred f12" id="spanPayeeCardNoTip2">开户人姓名需和银行卡开户人保持一致</span></div>'.format(c)) } else { j.push('<div class="item clearfix pbottom"><label class="lab" style=" line-height:18px;" id="spanPayeeCardNo">公司帐号：<br/><span class="f12 fgray" id="spanPayeeCardNoTip1" style="display:none">不支持存折&nbsp;&nbsp;</span></label><div class="element" style="width:200px;"><input type="text" class="text" style="width:190px;" maxlength="24" id="txtPayeeCardNo" value="{0}" require="true" dataType="CreditCard" rig="请输入公司账号" msg="请输入正确的公司账号" /></div></div><div class="item clearfix" style="padding:0px; line-height:20px;"><label class="lab">&nbsp;</label><span class="fred f12" id="spanPayeeCardNoTip2">公司名称需和公司账号开户人保持一致，否则会打款不成功</span></div>'.format(c)) } j.push('<div class="item clearfix"><label class="lab">开户银行所在地：</label><div class="fl"><select class="sel" id="selProvince_Payee"><option value="0">请选择</option>'); for (var p = 0; p < e.data.provinceList.length; p++) { var a = e.data.provinceList[p]; j.push('<option value="{0}"{1}>{2}</option>'.format(a.value, a.value == e.data.provinceCode ? ' selected="selected"' : "", a.title)) } j.push('</select><select class="sel" id="selCity_Payee" require="true" msg="请选择开户行所在地" datatype="Compare" operator="GreaterThan" to="0"><option value="0">请选择</option>'); if (e.data.cityList) { for (var p = 0; p < e.data.cityList.length; p++) { var m = e.data.cityList[p]; j.push('<option value="{0}"{1}>{2}</option>'.format(m.value, m.value == e.data.cityCode ? ' selected="selected"' : "", m.title)) } } j.push("</select></div></div>"); j.push('<div class="item clearfix" id="divPayeeSubBank" class="item clearfix" style="position:relative; {0}"><label class="lab">开户行支行名称：</label><div class="branch-info element show-text" style="width:240px;"><input type="text" class="banksub_inp fl"  id="txtPayeeSubBank" value="{1}" require="true" dataType="Require" msg="请输入开户行支行名称" rig="请输入开户行支行名称" placeholder="支持关键字查找" /><span class="branch-icon fl"></span></div></div>'.format(n ? "" : "display:none", q ? "" : $.HTMLEncode(k.payeeSubBankName))); j.push('<div class="item clearfix pbottom add"><label class="lab">收款人电话：</label><div class="element" style="width:140px;"><input type="text" class="text" id="txtPayeePhone" value="{0}" {1} require="true" dataType="MPhone" msg="请输入有效的电话格式 如：13588888888或0571-88888888" rig="请输入有效的电话格式 如：13588888888或0571-88888888" style="width:130px;"/></div></div>'.format(f, d ? ' disabled="disabled"' : "")); j.push('<div class="item clearfix"><label class="lab">&nbsp;</label><div class="fl"><a href="###" class="yellowbtn"><span>{0}</span></a></div></div></div>'.format(q ? "确定添加" : "确定修改")); var s = $(j.join("")); s.dialog({ title: q ? "添加收租账号" : "修改收租账号", modal: true, width: 570 }); Geography.bind("Payee"); PayeeJS.Index.payeeSubbranch = new SubbranchCombobox($("#divPayeeSubBank"), $("#selPayeeBank"), $("#selProvince_Payee"), $("#selCity_Payee"), b == 1); PayeeJS.Index.payeeSubbranch.bind(true); new $.BankCardNo($("#txtPayeeCardNo")); $("input[name=idPayeeType]").change(PayeeJS.Index.changePayeeType); Validator.bind(s); s.find("a[class=yellowbtn]").click(PayeeJS.Index.savePayee) }, changePayeeType: function() { var a = 1; if (a == "1") { $("#spanPayeeName").text("开户姓名："); $("#txtPayeeName").css("width", "130px").attr("dataType", "UserName").attr("msg", "请填写正确的银行卡开户姓名").attr("rig", "请填写银行卡开户姓名").parent().css("width", "140px"); $("#spanPayeeCardNo").text("银行卡号："); $("#spanPayeeCardNoTip1").show(); $("#txtPayeeCardNo").attr("rig", "请仔细填写并核对收款人银行卡卡号(不支持信用卡和存折)").attr("msg", "请输入正确的银行卡卡号"); $("#spanPayeeCardNoTip2").text("开户人姓名需和银行卡开户人保持一致"); if ($("#selPayeeBank option:selected").attr("hasSubbranch") == "true") { $("#divPayeeSubBank").show() } else { $("#divPayeeSubBank").hide() } PayeeJS.Index.payeeSubbranch.autoShow = true } else { $("#spanPayeeName").text("公司名称："); $("#txtPayeeName").css("width", "230px").attr("dataType", "CompanyName").attr("msg", "请输入正确的公司账户名称").attr("rig", "请输入公司账户名称").parent().css("width", "240px"); $("#spanPayeeCardNo").text("公司帐号："); $("#spanPayeeCardNoTip1").hide(); $("#txtPayeeCardNo").attr("rig", "请输入公司账号").attr("msg", "请输入正确的公司账号"); $("#spanPayeeCardNoTip2").text("公司名称需和公司账号开户人保持一致，否则会打款不成功"); $("#divPayeeSubBank").show(); PayeeJS.Index.payeeSubbranch.autoShow = false; PayeeJS.Index.payeeSubbranch.bind(true) } Validator.clearState($("#txtPayeeName"), false); Validator.clearState($("#txtPayeeCardNo"), false) }, savePayee: function() { if (!Validator.validateForm()) { return } $.post("/account/payee/savepayee.htm", { autoId: $("#hidAutoId").val(), payeeType: 1, payeeName: $("#txtPayeeName").val(), payeeBankId: $("#selPayeeBank").val(), payeeCardNo: $("#txtPayeeCardNo").val().replace(/\s/g, ""), payeeBankProvince: $("#selProvince_Payee").val(), payeeBankCity: $("#selCity_Payee").val(), payeeSubbranch: $("#txtPayeeSubBank").is(":visible") ? $("#txtPayeeSubBank").val() : "", payeePhone: $("#txtPayeePhone").val() }, function(a) { if (a.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(a.resultMsg) } }) }, showDeletePayee: function() { var a = $(this).parents(".admin-cont").attr("dataId"); if (a == undefined || a == null || a <= 0) { $.showMsgBox("您要删除的收租账号信息不存在，请重新选择!"); return } $.showConfirmBox("您确定删除当前收租账号？", function() { $.post("/account/payee/deletepayee.htm", { autoId: a }, function(b) { if (b.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(b.resultMsg) } }) }) } } }; var ScoreJS = { Index: { init: function() { $(".signin_success .t1 a").mousemove(function() { $(".t2").slideDown(900) }); $(".signin_success .t1 a").mouseleave(function() { $(".t2").slideUp() }); $("#btnSign").click(ScoreJS.Index.doSign); UserLevelTipBox.init() }, doSign: function() { $.post("/account/score/dosign.htm", {}, function(a) { if (a.resultCode == 1) { return $.showMsgBox("今日已签到成功 积分+5", function() { $.doUrlRedirt("/Member/Askpay.aspx") }, function() { $.doUrlRedirt("/Member/Askpay.aspx") }) } return $.showMsgBox(a.resultMsg) }) } }, Details: { init: function() { $(".score_search .detail-search input[type=text]").bind("click", WdatePicker); $("#selDateType").change(function() { if ($(this).val() == 4) { $(".score_search .detail-search").show() } else { $(".score_search .detail-search").hide(); ScoreJS.Details.doSearch() } }); $(".score_search .detail-search .search_btn").click(ScoreJS.Details.doSearch) }, doSearch: function() { var a = $("#selDateType").val(); var c = { datetype: a, tab: $.getQueryString("tab") }; if (a == 4) { var b = $(".score_search .detail-search input[type=text]"); c.startdate = $(b[0]).val(); c.enddate = $(b[1]).val() } return $.setUrlParam(c) } } }; var GiftJS = { Index: { init: function() { } }, Detail: { templateType: null, isAllowConvert: false, conTemplateDesc: ["移动号码", "联通号码", "电信号码", "邮箱地址或手机号码"], init: function(a) { if (a) { GiftJS.Detail.templateType = a.templateType; GiftJS.Detail.isAllowConvert = a.isAllowConvert } if (GiftJS.Detail.isAllowConvert) { $("#doConvert").click(GiftJS.Detail.showConvert) } }, showConvert: function() { if (!GiftJS.Detail.isAllowConvert || GiftJS.Detail.templateType == null || GiftJS.Detail.templateType <= 0) { return false } var b = new Array(); b.push('<div class="gift_box">'); b.push('<div class="item clearfix">'); b.push('<label class="lab">{0}：</label>'.format(GiftJS.Detail.templateType == 4 ? "支付宝帐号" : "手机号码")); var a = GiftJS.Detail.conTemplateDesc[GiftJS.Detail.templateType - 1]; if (a == undefined) { return false } b.push('<div class="element show-text"><input type="text" placeholder="{0}" id="txtConvert" require="true" dataType="{1}" msg="请输入正确的{0}" class="text"></div>'.format(a, GiftJS.Detail.templateType == 4 ? "AlipayAccount" : "Mobile")); b.push("</div></div>"); var c = $(b.join("")); c.dialog({ title: GiftJS.Detail.templateType == 4 ? "填写支付宝帐号" : "填写充值手机号码", modal: true, width: 400, buttons: [{ text: "确认无误，兑换", "class": "comm_dialog_btn_save", click: function() { GiftJS.Detail.doConvert() } }, { text: "取消", "class": "comm_dialog_btn_cancel", click: function() { $(this).dialog("destroy") } }] }); Validator.bind(c) }, doConvert: function() { if (!Validator.validateForm()) { return } $.post("/account/gift/doconvert.htm", { giftId: $.getQueryString("id"), convertAccount: $("#txtConvert").val().trim() }, function(a) { if (a.resultCode == 1) { $(".gift_box").dialog("destroy"); $.showMsgBox("提交兑换成功，等待租房宝审核。", function() { $.doUrlRedirt("/account/gift/") }, function() { $.doUrlRedirt("/account/gift/") }) } else { $.showMsgBox(a.resultMsg) } }) } } }; var GiftConvertJS = { Index: { init: function() { $("a[name=confirmShipped]").click(GiftConvertJS.Index.confirmShipped); $("a[name=confirmShipped]").click(GiftConvertJS.Index.confirmShipped) }, cancelConvert: function() { var a = $(this).parents("tr").attr("dataId"); $.showConfirmBox("您确定要取消兑换当前礼品吗？", function() { $.post("/account/gift/cancelconvert.htm", { convertId: a }, function(b) { if (b.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(b.resultMsg) } }) }) }, confirmShipped: function() { var a = $(this).parents("tr").attr("dataId"); $.showConfirmBox("您确定当前礼品已经收获成功了吗？", function() { $.post("/account/gift/confirmshipped.htm", { convertId: a }, function(b) { if (b.resultCode == 1) { return $.reloadUrl() } else { $.showMsgBox(b.resultMsg) } }) }) } } }; var UserLevelJS = { init: function() { $(".score_level .passrate,.score_level .rule").hover(function() { $(this).find(">div").show() }, function() { $(this).find(">div").hide() }) } }; var RedEnvelopeJS = { Index: { isFromAccountRedEnvelope: true, jsonAuditState: { 2: "您的红包正在审核中", 4: "您的红包审核未通过", 8: "您的奖品正在发货中，客官请稍等片刻", 16: "您的奖品已发货，我们正在快马加鞭送达您身边" }, init: function(b) { if (b) { RedEnvelopeJS.Index.isFromAccountRedEnvelope = b.isFromAccountRedEnvelope } $(".get_rec_frame").hover(function() { $(this).find(".get_rec_layer").show() }, function() { $(this).find(".get_rec_layer").hide() }); var a = $(".redpack_list ul li"); a.find(".do_open").click(function() { RedEnvelopeJS.Index.doOpenRedEnvelope($(this).parents("li").attr("dataId")) }); a.find(".do_receive").click(function() { RedEnvelopeJS.Index.showReceiveRedEnvelope($(this).parents("li").attr("dataId")) }); $(".redpack_list input[name=audit_state_desc]").click(function() { var d = $(this).attr("audit_state"); var c = RedEnvelopeJS.Index.jsonAuditState[d]; if (!String.isNullOrWhiteSpace(c)) { $.showMsgBox(c) } }) }, doOpenRedEnvelope: function(a) { $.post("/account/redenvelope/doopen.htm", { redEnvelopeId: a }, function(b) { if (b.resultCode == 1) { return RedEnvelopeJS.Index.showOpenRedEnvelopeSuccess(a, b.data) } else { if (b.resultCode == 11001) { return RedEnvelopeJS.Index.showInviteNotPayRent(b.data) } else { if (b.resultCode == 11002) { return RedEnvelopeJS.Index.showBeInviteNotPayRent() } else { $.showMsgBox(b.resultMsg); return false } } } }) }, showOpenRedEnvelopeSuccess: function(d, c) { var b = OriginalStringJS.showOpenRedEnvelopeSuccess.format(c); $(document.body).append(b); $("#do_accept").click(function() { if (RedEnvelopeJS.Index.isFromAccountRedEnvelope) { RedEnvelopeJS.Index.showReceiveRedEnvelope(d) } else { $.doUrlRedirt("/account/redenvelope/?tab=2", "_blank") } return false }); $(".layer_redpack_close").click(function() { return $.reloadUrl() }); var e = $(".layer_redpack"); var a = ($(window).width() - e.width()) / 2; var f = ($(window).height() - e.height()) / 2; e.css("top", f).css("left", a); $(".layer_redpack_shade").css("height", $(document).height()); return false }, showBeInviteNotPayRent: function() { var a = $(OriginalStringJS.redEnvelopeBeInviteNotPayRent); a.dialog({ title: "温馨提示", modal: true, width: 680 }); a.find(".nogetzg_btn").click(function() { $.doUrlRedirt("/payrent/", "_blank"); return false }); a.find(".nogetzg_con li").hover(function() { a.find(".nogetzg_con li a").removeClass("on"); $(this).find("a").addClass("on"); a.find(".nogetzg_con .nogetzg_img").removeClass("s1 s2 s3 s4").addClass("s{0}".format(Number($(this).index()) + 1)) }); return false }, showInviteNotPayRent: function(b) { var a = $(OriginalStringJS.redEnvelopeInviteNotPayRent.format(b)); a.dialog({ title: "温馨提示", modal: true, width: 480 }); a.find(".nogetzg_btn").click(function() { a.dialog("destroy"); return false }); return false }, showReceiveRedEnvelope: function(g) { var j = $.postJsonSync("/account/redenvelope/getuserreceiveaddresslist.htm", { redEnvelopeId: g }); if (j.resultCode != 1) { $.showMsgBox(j.resultMsg); return false } if (j.data.templateType == EnumJS.GiftTemplateTypeEnum.TelephoneFare.value) { return RedEnvelopeJS.Index.showTelephoneFareTemplate(g, j.data) } else { if (j.data.templateType == EnumJS.GiftTemplateTypeEnum.AlipayRedEnvelope.value) { return RedEnvelopeJS.Index.showAlipayRedEnvelopeTemplate(g, j.data) } } var d = j.data.addressList; var e = new Array(); e.push('<div class="get_prize">'); e.push('<div class="item clearfix"> <label class="lab">奖品：</label> <div class="element"><span class="f16 fbold forange">{0}</span></div></div>'.format(j.data.giftName)); e.push('<div class="item clearfix"> <label class="lab">收货信息：</label> <div class="element"><div class="rec_addr"><ul class="rec_addr_list" id="ulAddress">'); var h = d && d.length > 0; if (h) { for (var c = 0, f = d.length; c < f; c++) { var k = d[c]; e.push('<li dataId="{0}" jsonInfoValue="{1}" class="clearfix{2}"><input type="radio" {3} class="addr_radio" name="radio_addr"/>'.format(k.autoId, $.HTMLEncode(k.jsonInfoValue), c == 0 ? " selected" : "", c == 0 ? ' checked="checked"' : "")); e.push('<span class="addr_con">{0}&nbsp;|&nbsp;{1}&nbsp;|&nbsp;{2}</span><span class="addr_op"{3}><a href="###" name="do_edit">编辑</a>&nbsp;<a href="###" name="do_delete">删除</a></span></li>'.format(k.recipients, k.addrDesc, k.phone, c == 0 ? "" : ' style="display:none;"')) } } e.push('</ul><div class="add_addr_btn"{0}><a href="###" id="addNewAddress">新增收货地址</a></div>'.format(h ? "" : ' style="display:none;"')); e.push('<div class="add_addr" id="\divAddressInfo"{0}>'.format(h ? ' style="display:none;"' : "")); e.push('<table width="100%" border="0" cellpadding="0" cellspacing="0" class="addr_tab">'); e.push('<tr><td width="20%">收货人：</td><td width="80%"><div class="show-text"><input type="text" class="text" usenewclass="true" id="txtRecipients" value="{0}" require="true" dataType="UserName" msg="请填写正确的收货人姓名" placeholder="收货人姓名" style="width:280px;" /></div></td></tr>'.format(j.data.defaultUserName)); e.push('<tr><td>所在城市：</td><td><div><select class="sel" usenewclass="true" id="selProvince_Address"><option value="0">请选择</option>'); for (var c = 0; c < j.data.provinceList.length; c++) { var a = j.data.provinceList[c]; e.push('<option value="{0}"{1}>{2}</option>'.format(a.value, a.value == j.data.defaultProvinceCode ? ' selected="selected"' : "", a.title)) } e.push('</select><select class="sel" id="selCity_Address" usenewclass="true"><option value="0">请选择</option></select>'); e.push('<select class="sel" id="selArea_Address" require="true" usenewclass="true" msg="请选择所在地" datatype="Compare" operator="GreaterThan" to="0"><option value="0">请选择</option></select></div></td></tr>'); e.push('<tr><td>详细地址：</td><td><div class="show-text"><input type="text" usenewclass="true" class="text" id="txtAddr" require="true" dataType="Require" msg="请填写正确的详细地址" placeholder="请填写详细收货地址" style="width:280px;" /></div></td></tr>'); e.push('<tr><td>邮编：</td><td><div class="show-text"><input type="text" usenewclass="true" class="text" id="txtZipCode" require="true" dataType="Zip" msg="请填写正确的邮编" placeholder="请填写邮编" style="width:280px;" /></div></td></tr>'); e.push('<tr><td>联系方式：</td><td><div class="show-text"><input type="text" usenewclass="true" class="text" id="txtPhone" value="{0}" require="true" dataType="MPhone" msg="请填写正确的联系方式" placeholder="手机号码或者固定电话" style="width:280px;" /></div></td></tr>'.format(j.data.defaultUserMobile)); e.push("</table></div></div></div></div>"); e.push('<div class="item clearfix"><label class="lab"></label><div class="element"><div class="rent_btn qbtn"><a href="###" id="doReceive" class="rbtn_middle"><span>确认领取</span></a></div>'); e.push("</div></div></div>"); var b = $(e.join("")); b.dialog({ title: "领取信息", modal: true, width: 680 }); Geography.bind("Address"); Validator.bind(b); RedEnvelopeJS.Index.bindReceivePhysicalPanel(); b.find("#doReceive").click(function() { RedEnvelopeJS.Index.doReceiveRedEnvelope(j.data.giftName, g) }) }, showTelephoneFareTemplate: function(e, d) { var b = new Array(); var a = d.giftName; b.push('<div class="item-list ui-prompt" style="margin-left:0px;">'); b.push('<div class="item clearfix"><label class="lab">奖品：</label><div class="element" style="width:200px"><span class="f16 fbold forange">{0}</span></div>'.format(a)); b.push('<div class="item clearfix"><label class="lab">手机号：</label><div class="element" style="width:200px">{0}</div></div>'.format(d.isRealMobile ? d.mobile : '<input type="text" class="text" id="txtMobile" value="{0}"/>'.format(d.mobile))); b.push('<div class="item clearfix"><label class="lab">&nbsp;</label><div class="fl"><a href="###" class="yellowbtn"><span>确认领取</span></a></div></div></div>'); var c = $(b.join("")); c.dialog({ title: "领取信息", modal: true, width: 500 }); c.find("a[class=yellowbtn]").click(function() { var g = d.isRealMobile ? d.mobile : $("#txtMobile").val(); if (!Validator.Mobile.test(g)) { $.showMsgBox("您的手机号不正确, 请稍后再试"); return false } var h = { template_type: 1, mobile: g }; var f = { redEnvelopeId: e, isNeedSaveAppendInfo: false, appendInfoId: 0, convertInfo: JSON.stringify(h) }; $.post("/account/redenvelope/doreceive.htm", f, function(i) { if (i.resultCode == 1) { return RedEnvelopeJS.Index.showReceiveSuccess(a, EnumJS.GiftTemplateTypeEnum.TelephoneFare.value) } else { $.showMsgBox(i.resultMsg) } }) }); return false }, showAlipayRedEnvelopeTemplate: function(e, d) { var b = new Array(); var a = d.giftName; b.push('<div class="item-list ui-prompt" style="margin-left:0px;">'); b.push('<div class="item clearfix"><label class="lab">奖品：</label><div class="element" style="width:200px"><span class="f16 fbold forange">{0}</span></div>'.format(a)); b.push('<div class="item clearfix"><label class="lab">姓名：</label><div class="element show-text" style="width:200px"><input type="text" class="text" id="txtUserName" value="{0}" placeholder="支付宝账号的姓名"/></div></div>'.format(d.userName)); b.push('<div class="item clearfix"><label class="lab">支付宝账号：</label><div class="element show-text" style="width:200px"><input type="text" class="text" id="txtAlipayAccount" placeholder="手机号或邮箱"/></div></div>'); b.push('<div class="item clearfix"><label class="lab">&nbsp;</label><div class="fl"><a href="###" class="yellowbtn"><span>确认领取</span></a></div></div></div>'); var c = $(b.join("")); c.dialog({ title: "领取信息", modal: true, width: 500 }); c.find("a[class=yellowbtn]").click(function() { var h = $("#txtUserName").val(); if (!Validator.UserName.test(h)) { $.showMsgBox("请输入正确的支付宝账号的姓名"); return false } var g = $("#txtAlipayAccount").val(); if (!Validator.Mobile.test(g) && !Validator.Email.test(g)) { $.showMsgBox("请输入正确的支付宝账号"); return false } var i = { template_type: 2, alipay_name: h, alipay_account: g }; var f = { redEnvelopeId: e, isNeedSaveAppendInfo: false, appendInfoId: 0, convertInfo: JSON.stringify(i) }; $.post("/account/redenvelope/doreceive.htm", f, function(j) { if (j.resultCode == 1) { return RedEnvelopeJS.Index.showReceiveSuccess(a, EnumJS.GiftTemplateTypeEnum.AlipayRedEnvelope.value) } else { $.showMsgBox(j.resultMsg) } }) }); return false }, showReceiveSuccess: function(d, b) { var e = []; e.push('<div class="prize_success">'); e.push('<div class="prize_success_t1">恭喜您！</div>'); e.push('<div class="prize_success_t2">成功领取 “{0}”</div>'.format(d)); e.push('<div class="prize_success_t3">{0}</div>'.format(b == EnumJS.GiftTemplateTypeEnum.Physical.value ? "审核通过后3日内发货，具体收货日期请以快递时间为准。" : "审核通过后3日内充值，具体到账时间请以实际到账为准。")); e.push('<div class="prize_success_share"><div class="share_text">赶紧把这好消息告诉您的小伙伴吧</div>'); e.push('<div class="share_op_go" id="divShareInviteBox"><div class="jiathis_style">'); e.push('<span class="jiathis_txt">分享到：</span>'); e.push('<a class="jiathis_button_tsina"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_tqq"></a><a class="jiathis_button_weixin"></a><a class="jiathis_button_douban"></a>'); e.push('<a class="jiathis_button_cqq"></a><a class="jiathis_button_tieba"></a><a class="jiathis_button_renren"></a></div>'); e.push("</div>"); e.push("</div></div></div>"); var a = $(e.join("")); a.dialog({ title: "温馨提示", modal: true, width: 500, buttons: [{ text: "确定", "class": "comm_dialog_btn_save", click: function() { return $.reloadUrl() } }] }); $(".ui-dialog-titlebar-close").click(function() { return $.reloadUrl() }); var c = $("#divShareInviteBox"); c.append('<script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js?uid=1372732640880429" charset="utf-8"><\/script>'); c.append('<script type="text/javascript">var jiathis_config = {url: "http://www.zufangbao.com/events/redenvelope/invite.htm",summary: "哇，快来围观！我抽中了“{0}”，租房宝付房租真是太给力啦！8.18日到9.6日期间租房宝发送每日限量100个特权账户，特权账户邀请小伙伴支付房租成功后双方即可领取奖品红包，奖品总价值高达50万，100%中奖，还不快去抢！",title: "我成功领取了“{1}”",pic: "http://res.zufangbao.com/images/www/events/redenvelope/act_redpack_adimg.png",hideMore: false};<\/script>'.format(d, d)); c.find(".jiathis_style a").hover(function() { if ($(this).hasClass("jiathis_button_weixin")) { jiathis_config.url = "http://mp.weixin.qq.com/s?__biz=MjM5OTUzOTQ4NA==&mid=200417757&idx=1&sn=b0e10e6ef690b629d06cfc7fdf99e5c6#rd"; jiathis_config.summary = "" } else { jiathis_config.url = "http://www.zufangbao.com/events/redenvelope/invite.htm"; jiathis_config.summary = "要付房租的小伙伴们有福啦~我帮你们争取了在租房宝抽百分百中奖的红包！快戳链接支付一起领奖品！什么？你还不知道？！租房宝可是全国首家可以用信用卡支付房租的平台哦~安全快捷高效可信！" } }); return false }, bindReceivePhysicalPanel: function() { var objAddress = $("#ulAddress"); if (objAddress.find("li").length == 0 && $("#selProvince_Address").val() > 0) { Geography.syncLoadCityList("Address") } $("#addNewAddress").click(function() { $("#divAddressInfo").show(); $("#divAddressInfo").attr("autoId", ""); objAddress.find(".addr_op").hide(); objAddress.find("li").removeClass("selected"); objAddress.find('input:radio[name="radio_addr"]').attr("checked", false); $("#txtRecipients, #selProvince_Address, #selCity_Address, #selArea_Address, #txtAddr, #txtZipCode, #txtPhone").val("") }); objAddress.find("li").change(function() { $("#divAddressInfo").hide(); objAddress.find("li .addr_op").hide(); $(this).find(".addr_op").show(); objAddress.find("li").removeClass("selected"); $(this).addClass("selected") }); objAddress.find("li a[name=do_edit]").click(function() { objAddress.find('input:radio[name="radio_addr"]').attr("checked", false); objAddress.find("li").removeClass("selected"); objAddress.find(".addr_op").hide(); $("#divAddressInfo").attr("autoId", $(this).parents("li").attr("dataId")); $("#divAddressInfo").show(); var jsonData = $(this).parents("li").attr("jsonInfoValue"); jsonData = eval("jsonData=" + jsonData); $("#txtRecipients").val(jsonData.recipients); $("#selProvince_Address").val(jsonData.province_code); Geography.syncLoadCityList("Address"); $("#selCity_Address").val(jsonData.city_code); Geography.syncLoadAreaList("Address"); $("#selArea_Address").val(jsonData.area_code); $("#txtAddr").val(jsonData.addr); $("#txtZipCode").val(jsonData.zip_code); $("#txtPhone").val(jsonData.phone) }); objAddress.find("li a[name=do_delete]").click(RedEnvelopeJS.Index.deletReceiveAddress) }, deletReceiveAddress: function() { var a = $(this).parents("li"); var b = a.attr("dataId"); $.showConfirmBox("您确定要删除当前收获信息吗？", function() { $.post("/account/redenvelope/deleteuserreceiveaddress.htm", { autoId: b }, function(c) { if (c.resultCode == 1) { a.remove(); $("#divAddressInfo").hide(); $("#txtRecipients, #selProvince_Address, #selCity_Address, #selArea_Address, #txtAddr, #txtZipCode, #txtPhone").val() } else { $.showMsgBox(c.resultMsg) } }) }) }, doReceiveRedEnvelope: function(f, e) { var d = $("#divAddressInfo"); var b = d.is(":visible"); var c = d.attr("autoId") != undefined && d.attr("autoId") > 0 ? d.attr("autoId") : 0; var a = { redEnvelopeId: e, isNeedSaveAppendInfo: b, appendInfoId: c }; if (b) { if (!Validator.validateForm()) { return } var g = { template_type: 3, recipients: $("#txtRecipients").val(), province_code: $("#selProvince_Address").val(), province_name: $("#selProvince_Address").find("option:selected").text(), city_code: $("#selCity_Address").val(), city_name: $("#selCity_Address").find("option:selected").text(), area_code: $("#selArea_Address").val(), area_name: $("#selArea_Address").find("option:selected").text(), addr: $("#txtAddr").val(), zip_code: $("#txtZipCode").val(), phone: $("#txtPhone").val() }; a.convertInfo = JSON.stringify(g) } else { var g = $('#ulAddress input:radio[name="radio_addr"]:checked').parents("li").attr("jsonInfoValue"); if (String.isNullOrWhiteSpace(g)) { $.showMsgBox("请完善您的领取信息"); return false } a.convertInfo = g } $.post("/account/redenvelope/doreceive.htm", a, function(h) { if (h.resultCode == 1) { return RedEnvelopeJS.Index.showReceiveSuccess(f, EnumJS.GiftTemplateTypeEnum.Physical.value) } else { $.showMsgBox(h.resultMsg) } }) } } };